---
title: "NISRA Technology and Support Lab RAP Skeleton Demo Report"
lang: "en"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true 
    toc_depth: 4
    code_download: no
    css: "../style.css"
    includes:
      in_header: "../meta.html"
knit: (function(input, ...) {
    rmarkdown::render(
      input,
       output_dir = "../demo/demo_outputs/",
        output_file = paste0(
        xfun::sans_ext(input), '_', format(Sys.time(), "%d-%m-%Y_%H%M") , '.html'
      ),
      envir = globalenv()
    )
  })
params:
  annotations:
    true
---

<div id = "cookie-banner"></div>
<script src = "cookies_script.js"></script>

```{r settings, include=FALSE}
# this chunk sets chunk options for all chunks in this file
knitr::opts_chunk$set(
  message = FALSE, warning = FALSE, echo = FALSE
)
```

```{r setup, warnings = FALSE}
library(here)

source(here("code/demo/demo_data_prep.R"))
source(here("code/demo/demo_excel_tables.R"))
```

<div data-nics-theme="`r nics_theme`">

<!-- these <header> and <main> tags are important for accessibility, they define landmark areas for screenreaders. -->
<header>
<!-- calling the banner code -->
`r f_banner(title = rmarkdown::metadata$title)`


<!-- Header section -->
`r f_header()`
</header>

<!-- Introduction section -->

<!-- open main div -->
<main id="main">

<!-- calling the borderline code -->
`r f_borderline()`
    
## 1. Key findings (h2)

This section includes the key points of your publication (in an unordered list).  The logos used in the banner are intentionally placed in order. NISRA logo on left and department on right, if an Accredited Official Statistics publication then this logo will be in the middle. Logo placement is automated in the code depending on which logos are required. 

There are some key accessibility features to highlight here:

- the language element is set to English, which is done in the YAML section of the code 
- there is a named accessibility contact at the end of the doc
- you will see from the code that the main sections of the html are enclosed in div elements

It can help automation of reports to include sections of text that contain numerical values calculated by code. These will then update automatically when the data changes. This has been implemented below. For key points with accompanying charts or graphics, a two column structure can be used.

### Population change

```{r key_point_2_column, fig.alt="info", echo = TRUE}
# create a bullet point in unicode called 'b'
b <- "\U2022"

point_1 <- paste0(
  b, " The Northern Ireland population grew from ",
  round_half_up(ni_earliest_total, 2), " million in ",
  earliest_year, " to ", round_half_up(ni_latest_total, 2),
  " million in ", latest_year, ", an increase of ",
  round_half_up(ni_earliest_latest_change, 0), " percent."
)

point_2 <- paste0(
  b, " Under 25s make up the largest age group in the ",
  "population."
)

point_3 <- paste0(
  b, " Derry City and Strabane has seen the largest increase ",
  "of all the LGDs (Local Government Districts)."
)


change_chart <- here(
  "code/demo/demo_data/images/mini_population.png"
)

div(
  class = "row",
  div(
    class = "col-sm-6", style = "margin-top: 10px; font-size:120%;",
    point_1, p(), point_2, p(), point_3
  ),
  div(
    class = "col-sm-6",
    img(
      src = change_chart,
      alt = "Column chart showing relative increase in population"
    )
  )
)
```

`r f_borderline()`

## 2. Introduction (h2)

```{r introduction_sub_report, child='02_introduction.Rmd' }
```

`r f_borderline()`

## 3. Infographics and images (h2)

```{r infographics_sub_report , child='03_infographics.Rmd'}
```

`r f_borderline()`

## 4. Tables (h2)

```{r tables_sub_report , child='04_tables.Rmd'}
```

`r f_borderline()`

## 5. Charts (h2)

```{r charts_sub_report  , child='05_charts.Rmd'}
```

`r f_borderline()`

## 6. Maps (h2)

```{r maps_sub_report , child='06_maps.Rmd'}
```  
  
`r f_borderline()`  

## 7. Download data (h2) {#download-data}

```{r download_data_sub_report , child='07_download_data.Rmd'}
```  

`r f_borderline()`

## 8. Notes for readers  (h2)
```{r notes_for_readers_sub_report, child='08_notes_for_readers.Rmd'}
```

`r f_borderline()`

## 9. Text presentation  (h2)
```{r text_presentation_sub_report, child='09_text_presentation.Rmd'}
```

`r f_borderline()`

## 10. Useful acessibility links (h2)

```{r useful_links_sub_report, child='10_useful_links.Rmd'}
```

`r f_borderline()`

## 11. Accredited official statistics and official statistics (h2)

```{r accredited_stats_sub_report, child='11_accredited_stats.Rmd'}
```

`r f_borderline()`

## 12.Contact details (h2)

`r f_contact()`

### Accessibility contact (h3)

Please contact Dissemination Branch for assistance with accessibility requirements or alternative formats. Contact details are:

<strong>Email:</strong> info@nisra.gov.uk

<strong>Telephone:</strong> +44 (0)300 200 7836

Dissemination Branch  
NISRA  
Colby House  
Stranmillis Court  
BELFAST  
BT9 5RR  
  
  
    
<!-- close main div -->
</main>


```{r render-footer, results='asis', echo=FALSE}
f_footer()
```


<script>
  // Create array of alt texts for map shapes
  const map_alt = `r if (exists("map_alt")) {map_alt} else {"[]"}`;
</script>

`r if (params$annotations) '<script id="annotation-script" src="annotation.js"></script>'`

```{js}

// Accessibility function to remove map shapes from tab order, add tabs to table of contents and add empty alt text to map legend 

function tabOrder() {

  // Removes tabs from individual map shapes and appends alt texts

  var shapes = document.getElementsByClassName('leaflet-marker-icon leaflet-zoom-animated leaflet-interactive');

  for (var i=0; i<shapes.length; i++) {
    shapes[i].tabIndex = -1;
    shapes[i].alt = map_alt[i];
  }
  
  // Make side menu tabbable
  
  let headings = document.getElementsByClassName('tocify-item list-group-item');
  let sections = document.getElementsByClassName('section');
  
  for (let i = 0; i < headings.length; i ++) {
    headings[i].innerHTML = "<a href='#" + sections[i].id + "'>" + headings[i].innerHTML +  "</a>";
  }
  
  // Remove white space at bottom
  const space_observer = new MutationObserver(() => {
    let space = document.getElementsByClassName("tocify-extend-page");
    for (let i = 0; i < space.length; i ++) {
      space[i].remove();
    }
  });

  space_observer.observe(document.getElementsByClassName("main-container")[0], { childList: true, subtree: true });
  

// Hide entire legend from screen readers
  var legendContainer = document.querySelector('.info.legend');
  if (legendContainer) {
    legendContainer.setAttribute('aria-hidden', 'true');
  }

 // Add empty alt text to each legend image
  var legendImages = document.querySelectorAll('.info.legend img');
  for (var j = 0; j < legendImages.length; j++) {
    legendImages[j].setAttribute('alt', '');
    legendImages[j].setAttribute('aria-hidden', 'true'); // Extra assurance
  }
}

// Instruct web browser to run above function when loaded
window.onload = tabOrder;

```

<!-- close data-nics-theme div -->
</div>
